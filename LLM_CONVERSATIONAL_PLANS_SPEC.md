# LLM-Based Conversational Plan Generation - Feature Spec

## ðŸ“‹ Overview

This spec defines a new feature that transforms the NutriFit chatbot from a structured plan generator into a conversational planning assistant. Users can explore meal and workout options through natural dialogue with Llama (via Ollama), refine their requirements iteratively, and save plans only when satisfied.

## ðŸŽ¯ Goals

1. **Natural Conversation**: Use LLM to generate meal/workout plans in natural language
2. **User Control**: Let users explore and refine before committing
3. **Save Functionality**: Add "Save to My Plans" buttons to commit plans to dashboard
4. **Structured Data**: Parse LLM text into structured data for tracking
5. **Seamless Integration**: Saved plans appear in existing Meal/Workout panels

## ðŸ“ Spec Location

```
.kiro/specs/llm-conversational-plans/
â”œâ”€â”€ requirements.md  - 10 detailed requirements with acceptance criteria
â”œâ”€â”€ design.md        - Complete architecture and implementation design
â””â”€â”€ tasks.md         - 15 implementation tasks with dependencies
```

## ðŸ”‘ Key Features

### 1. LLM-Generated Plans
- Chatbot uses Llama to generate meal/workout plans conversationally
- Plans include specific meals, exercises, nutritional info, and timing
- Respects user's dietary preferences, fitness goals, and targets

### 2. Save to Dashboard
- "Save to Meal Plans" button appears after meal plan generation
- "Save to Workout Plans" button appears after workout plan generation
- Clicking saves the plan to the user's dashboard
- Button shows loading state and disables after save

### 3. Plan Parsing
- New `PlanParser` module extracts structured data from LLM text
- Uses regex patterns and NLP to identify meals, exercises, macros
- Validates and fills in missing data with reasonable defaults
- Handles parsing failures gracefully

### 4. Iterative Refinement
- Users can ask for modifications through conversation
- "Regenerate" button creates a new version
- Each version gets its own save button
- Only the latest version is saved

### 5. Dashboard Integration
- Saved plans appear in Meal Plans / Workout Plans panels
- Plans marked as "Generated by AI Chat"
- Full tracking and progress monitoring capabilities
- Can be edited like any other plan

## ðŸ—ï¸ Architecture

```
User Chat Request
       â†“
Intent Detection
       â†“
LLM Plan Generation (Llama via Ollama)
       â†“
Display in Chat with Save Button
       â†“
User Clicks Save
       â†“
Plan Parser (Text â†’ Structured Data)
       â†“
Save to Database
       â†“
Confirmation + Disable Button
```

## ðŸ“ Implementation Tasks

### Phase 1: Core Functionality (Tasks 1-5)
- Create Plan Parser module
- Enhance Chatbot Engine with LLM generation
- Update intent detection
- Add save plan API endpoint
- Enhance chat response format

### Phase 2: UI Components (Tasks 6-10)
- Add save button UI component
- Implement save plan JavaScript
- Update message rendering
- Add plan regeneration
- Integrate with dashboard

### Phase 3: Polish & Testing (Tasks 11-15)
- Error handling and fallbacks
- Helpful prompts and examples
- Unit tests for parser
- Integration tests
- Documentation

## ðŸŽ¨ UI/UX Flow

### Example Conversation

**User:** "I want a full meal plan with 2000 calories, 130g protein, 30g carbs, 100g fat"

**Chatbot:** 
```
Great! I've created a 7-day meal plan for you!

ðŸ“Š Your Daily Targets:
- Calories: 2000 kcal
- Protein: 130g
- Carbs: 30g
- Fat: 100g

ðŸ“… Your Complete Weekly Meal Plan:

**Day 1 (2025-12-03):**
- ðŸ³ Breakfast: Scrambled Eggs with Avocado (~450 kcal, P: 25g, C: 8g, F: 35g)
- ðŸ¥— Lunch: Grilled Chicken Salad (~500 kcal, P: 40g, C: 10g, F: 30g)
- ðŸ½ï¸ Dinner: Salmon with Asparagus (~650 kcal, P: 45g, C: 8g, F: 25g)
- ðŸŽ Snack: Almonds and Cheese (~400 kcal, P: 20g, C: 4g, F: 10g)
- ðŸ“Š Daily Total: ~2000 kcal

[... Days 2-7 ...]

[ðŸ’¾ Save to Meal Plans] [ðŸ”„ Regenerate]
```

**User clicks "Save to Meal Plans"**

**Chatbot:** "âœ… Meal plan saved! Check your Meals tab to view and track your plan."

## ðŸ”§ Technical Details

### LLM Prompts
- Structured prompts with user profile data
- Specific formatting instructions for parsing
- Nutritional accuracy requirements
- Variety and preference constraints

### Parsing Strategy
1. **Regex-based extraction** (primary)
2. **Keyword matching** (secondary)
3. **LLM JSON reformatting** (tertiary)
4. **Minimal plan with confirmation** (fallback)

### Error Handling
- LLM unavailable â†’ Fallback to structured generator
- Parsing failed â†’ Offer to regenerate
- Incomplete data â†’ Use defaults + notify user
- All errors logged for debugging

## ðŸ“Š Success Metrics

- âœ… Users can generate plans conversationally
- âœ… Save buttons work reliably
- âœ… Parsing accuracy > 80%
- âœ… Plans integrate seamlessly with dashboard
- âœ… Error rate < 5%
- âœ… User satisfaction with conversational UX

## ðŸš€ Next Steps

1. **Review this spec** - Ensure it meets your requirements
2. **Prioritize tasks** - Decide which tasks to implement first
3. **Set up development** - Ensure Ollama is running
4. **Start implementation** - Begin with Phase 1 tasks
5. **Iterate and test** - Test each component thoroughly

## ðŸ“š Related Documents

- **Requirements**: `.kiro/specs/llm-conversational-plans/requirements.md`
- **Design**: `.kiro/specs/llm-conversational-plans/design.md`
- **Tasks**: `.kiro/specs/llm-conversational-plans/tasks.md`

## ðŸ’¡ Future Enhancements

- Plan comparison (LLM vs structured)
- Plan history in chat
- Multi-turn refinement conversations
- Template learning from saved plans
- Real nutritional database integration
- Voice input for plan requests
- Plan sharing with friends

---

**Status**: âœ… Spec Complete - Ready for Implementation
**Estimated Effort**: 3-5 days
**Priority**: High (User-Requested Feature)
